# machinat-auth

This package provide an interface to combine all the auth flow of chat platforms into one  single web application.

Below is an `authorization code grant` flow example:

```
 +-------+   +---------+ +-----+      +--------+     +--------+        +-----+
 | User  |   | Browser | | App |      | Client |     | Server |        | IdP |
 +-------+   +---------+ +-----+      +--------+     +--------+        +-----+
   |             |         |              |               |                 |
   | linked      |         |              |               |                 |
   | from IM     |         |              |               |                 |
   |------------>|         |              |               |                 |
   |             |         |              |               |                 |
   |             | run     |              |               |                 |
   |             |-------->|              |               |                 |
   |             |         |              |               |                 |
   |             |         | #init()      |               |                 |
   |             |         |------------->|               |                 |
   |             |         |              |               |                 |
   |             |         |              | redirect      |                 |
   |             |         |              |-------------->|                 |
   |             |         |              |               |                 |
   |             |         |              |    save state |                 |
   |             |<---------------------------------------|                 |
   |             |         |              |               |                 |
   |             |         |              |               | redirect        |
   |             |         |              |               |---------------->|
   |             |         |              |               |                 |
   |             |         |              |               |  ask permission |
   |<-----------------------------------------------------------------------|
   |             |         |              |               |                 |
   | allow auth  |         |              |               |                 |
   |----------------------------------------------------------------------->|
   |             |         |              |               |                 |
   |             |         |              |               |        redirect |
   |             |         |              |               |         w/ code |
   |             |         |              |               |<----------------|
   |             |         |              |               |                 |
   |             |         |              |               | exchange        |
   |             |         |              |               | token           |
   |             |         |              |               |---------------->|
   |             |         |              |               |                 |
   |             |         |              |               |    token & data |
   |             |         |              |               |<----------------|
   |             |         |              |               |                 |
   |             |         |              |     sign auth |                 |
   |             |         |              |       cookies |                 |
   |             |<---------------------------------------|                 |
   |             |         |              |               |                 |
   |             |         |              |      redirect |                 |
   |             |         |<-----------------------------|                 |
   |             |         |              |               |                 |
   |             |         | #init()      |               |                 |
   |             |         |------------->|               |                 |
   |             |         |              |               |                 |
   |             |         | start        |               |                 |
   |             |         |------        |               |                 |
   |             |         |     |        |               |                 |
   |             |         |<-----        |               |                 |
   |             |         |              |               |                 |
   |             |         | #auth()      |               |                 |
   |             |         |------------->|               |                 |
   |             |         |              |               |                 |
   |             |         |         auth |               |                 |
   |             |         |      context |               |                 |
   |             |         |<-------------|               |                 |
   |             |         |              |               |                 |
   |             |         | call API w/ auth cookies     |                 |
   |             |         |----------------------------->|                 |
   |             |         |              |               |                 |
   |             |         |              authorized data |                 |
   |             |         |<-----------------------------|                 |
   |             |         |              |               |                 |
   |           interact as |              |               |                 |
   |           authed user |              |               |                 |
   |<----------------------|              |               |                 |
   |             |         |              |               |                 |
```
